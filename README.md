# java-convenience-store-precourse

# 기능 요구 사항 분석

<code>구매자의 할인 혜택, 재고 상황을 고려하여 최종 결제 금액을 계산하고 안내하는 결제 시스템을 구현</code>

### 재고 관리

* 각 재고 관리 파일은 products.md 파일과 promotions.md 파일로 정의된다.
* 코드 실행시가 아닌, 불러오는 시점에서 해당 관리 파일을 통해 products와 promotions를 매핑한다.
    * 상품이 결제된 이후 업데이트 된 md 파일을 받아 최신화 상태이어야 한다.
* 로직이 실행 될 때 각 모델에서 가져와 로직을 실행한다.
* 결제가 진행되기 전에 최신 md 파일에서 개수를 확인하고 업데이트 한다.
    * 동시에 누군가 재고 상품을 결제한 경우 결제가 진행되지 않도록 한다.

### 프로모션 할인

* 오늘 날짜가 프로모션 기간 내에 포함된 경우에만 할인 적용이 가능하도록 한다.
    * 만약 상품 재고를 구매하기 위해 상품을 입력했을 때 프로모션 기간이 지난 경우 프로모션 할인이 진행되지 않도록 한다.
    * 결제를 진행하기 전 프로모션 기간이 지났는지 확인이 필요하다.
* 프로모션의 형태는 N개 구매 시 1개 무료 증정 형태로 진행하며 여러개의 프로모션은 허용하지 않는다.
    * ex)
      ```
      탄산2+1,2,1
      MD추천상품,1,1
      반짝할인,1,1
      ```
* 프로모션 혜택은 프로모션 재고 내에서만 적용이 가능하도록 한다.
    * 일반 재고, 프로모션 재고가 존재한다.
    * 처음 구매 시에도 프로모션 재고 상품을 우선적으로 차감한다. (일반 재고가 없을 경우 프로모션 재고를 사용)
        * 프로모션 재고가 부족한 경우, 해당 프로모션 혜택을 재공하고, 일반 재고를 사용 후 안내를 해야 한다.
        * ex)
      ```
      - 콜라 1,000원 7개 탄산2+1
      - 콜라 1,000원 10개
      
      구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])
      [콜라-10]
  
      현재 콜라 4개는 프로모션 할인이 적용되지 않습니다. 그래도 구매하시겠습니까? (Y/N)
      ```
        * Y인 경우 일부 수량에 대해 정가로 결제를 준비한다.
        * N인 경우 정가로 결제해야 하는 수량 만큼 제외한 후 결재를 준비한다.
        * 멤버십 할인 여부를 묻고 결재를 진행 한다.
    * 프로모션 재고가 없을 경우에 일반 재고를 사용한다.
      * 일반 재고도 없을 경우 
      <code>구매 수량이 재고 수량을 초과한 경우: [ERROR] 재고 수량을 초과하여 구매할 수 없습니다.
      * 다시 입력해 주세요.</code> 출력한다.
    * 구매자가 프로모션 재고 상품 구매가 가능하지만 더 적게 가져온 경우 안내 를 진행한다.
    * ex)
      ```
      - 오렌지주스 1,800원 9개 MD추천상품
      - 오렌지주스 1,800원 재고 없음
      
      구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])
      [오렌지주스-1]
  
      현재 오렌지주스은(는) 1개를 무료로 더 받을 수 있습니다. 추가하시겠습니까? (Y/N)
      Y
      ```
        * Y인 경우 증정 받을 수 있는 상품을 추가하고 결제를 준비한다.
        * N인 경우 증정 받을 수 있는 상품을 추가하지 않고 결제를 준비한다.
    * 구매 수량이 재고 수량을 초과한 경우에 <code>[ERROR] 재고 수량을 초과하여 구매할 수 없습니다. </code> 이후 다시 입력받는다.
    * 결재가 진행이 완료되면 추가 구매 여부를 입력받는다.
      * Y인 경우 재고 업데이트 상품 목록을 확인 후 추가로 구매를 진행한다.
      * N인 경우 구매를 종료.

### 멤버십 할인
* 멤버십 회원은 프로모션 미적용 금액의 30%를 할인 받는다.
* 프로모션 적용 후 남은 금액에 대해 멤버십 할인을 적용한다.
* 멤버십 할인의 최대 한도는 8,000원 이다.


### 영수증 출력
* 영수증은 고객의 구매 내역과 할인을 요약하여 출력하면 된다.
  * 영수증 항목
    * 구매 상품 내역: 구매한 상품명, 수량, 가격
    * 증정 상품 내역: 프로모션에 따라 무료로 제공된 증정 상품의 목록
    * 금액 정보
      * 총 구매액: 구매한 상품의 총 수량과 총 금액
      * 행사 할인: 프로모션에 의해 할인된 금액
      * 멤버십 할인: 멤버십에 의해 추가로 할인된 금액
      * 내실돈: 최종 결제 금액
* 보기 좋게 정렬하여 고객이 쉽게 금액과 수량을 확인할 수 있게 한다.

<hr>

## 입출력 요구사항 분석

### 입력
* 구현에 필요한 상품, 행사 목록은 파일 입출력을 통해 관리한다.
* 구매할 상품명과 수량의 구분자는 하이폰(-)으로 구분하며, 개별 상품은 대괄호([])로 묶어 쉼표(,)로 구분한다.
    <code>[콜라-10],[사이다-3]</code>
* Y/N의 경우 대문자, 소문자 모두 허용한다.
* 사용자의 입력이 잘못된 경우
    ```
    사용자의 입력에서 IllegalArgumentException 처리
  
    구매할 상품과 수량 형식이 올바르지 않은 경우: [ERROR] 올바르지 않은 형식으로 입력했습니다. 다시 입력해 주세요.
    기타 잘못된 입력의 경우: [ERROR] 잘못된 입력입니다. 다시 입력해 주세요.

    해당 모델에서 IllegalStateException  처리
    존재하지 않는 상품을 입력한 경우: [ERROR] 존재하지 않는 상품입니다. 다시 입력해 주세요.
    구매 수량이 재고 수량을 초과한 경우: [ERROR] 재고 수량을 초과하여 구매할 수 없습니다. 다시 입력해 주세요.
    
    ```
    * 에러 메시지 출력 이후 다시 인풋을 받을 수 있도록 한다. 

<hr> 

## 프로그래밍 요구사항 분석
* indent 2까지만 허용한다.
  * ex) while() { if() } indent → 2
* 3항 연산자 제한
* 함수는 한가지 일만 하도록 한다. 
* Junit 5 AssertJ 정리한 기능 목록이 정상적으로 작동하는지 테스트 코드로 확인한다. 
* else 사용 금지, switch,case 사용 금지 
* 상수는 Enum으로 관리한다. 
* 함수 메서드 길이가 10이 넘어가지 않도록 구현한다. 공백 또한 라인이다. 
* 입출력 담당 클래스 별도 구현


<hr>

## 편의점 서비스 프로세스
1. md파일 입출력을 통해 해당 상품의 최신 상태 정보를 받아온다.
2. 현재 보유하고 있는 상품 정보를 재공
3. 구매할 상품 명과 수량을 입력
4. 여러개의 상품들을 구매 가능
    1. 프로모션 상품 먼저 선입선출한다.
    2. 일반 품목의 상품이 없고 프로모션에 있다면 프로모션 개수 차감
    3. 구매자가 구매한 프로모션 상품까지 존재한다면 바로 따로 출력 없이 할인
5. 멤버십 할인을 받을지 여부
6. 구매 로직을 처리하고 해당 상품들의 수량 및 차감
7. 레시피 영수증 출력
8. 반복(구매하고 싶은 다른 상품이 있는가?)
9. 프로모션이 적용 가능한 상품인데 한개 더 적게 가져온 경우
10. 무료로 더 받을지 추가 여부
    1. Y: 증정받을 수 있는 상품을 추가
    2. N: 상품을 추가하지 않음
11. 멤버십 여부 확인 후 결제
12. 반복()
13. 프로모션 적용 가능한 상품에서 프로모션 재고가 부족하여 혜택 없이 결제해야 하는 경우
    1. Y: 상품 모두 정가로 결제 준비
    2. N: 정가로 결제해야 하는 수량만큼만 제외시키고 결제 준비
14. 멤버십 할인 적용 여부 확인 후 결제
15. 반복()
<hr>

<details>
<summary>실행 결과 예시</summary>
<div markdown="1">

```
안녕하세요. W편의점입니다.
현재 보유하고 있는 상품입니다.

- 콜라 1,000원 10개 탄산2+1
- 콜라 1,000원 10개
- 사이다 1,000원 8개 탄산2+1
- 사이다 1,000원 7개
- 오렌지주스 1,800원 9개 MD추천상품
- 오렌지주스 1,800원 재고 없음
- 탄산수 1,200원 5개 탄산2+1
- 탄산수 1,200원 재고 없음
- 물 500원 10개
- 비타민워터 1,500원 6개
- 감자칩 1,500원 5개 반짝할인
- 감자칩 1,500원 5개
- 초코바 1,200원 5개 MD추천상품
- 초코바 1,200원 5개
- 에너지바 2,000원 5개
- 정식도시락 6,400원 8개
- 컵라면 1,700원 1개 MD추천상품
- 컵라면 1,700원 10개

구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])
[콜라-3],[에너지바-5]

멤버십 할인을 받으시겠습니까? (Y/N)
Y 

==============W 편의점================
상품명		수량	금액
콜라		3 	3,000
에너지바 		5 	10,000
=============증	정===============
콜라		1
====================================
총구매액		8	13,000
행사할인			-1,000
멤버십할인			-3,000
내실돈			 9,000

감사합니다. 구매하고 싶은 다른 상품이 있나요? (Y/N)
Y

안녕하세요. W편의점입니다.
현재 보유하고 있는 상품입니다.

- 콜라 1,000원 7개 탄산2+1
- 콜라 1,000원 10개
- 사이다 1,000원 8개 탄산2+1
- 사이다 1,000원 7개
- 오렌지주스 1,800원 9개 MD추천상품
- 오렌지주스 1,800원 재고 없음
- 탄산수 1,200원 5개 탄산2+1
- 탄산수 1,200원 재고 없음
- 물 500원 10개
- 비타민워터 1,500원 6개
- 감자칩 1,500원 5개 반짝할인
- 감자칩 1,500원 5개
- 초코바 1,200원 5개 MD추천상품
- 초코바 1,200원 5개
- 에너지바 2,000원 재고 없음
- 정식도시락 6,400원 8개
- 컵라면 1,700원 1개 MD추천상품
- 컵라면 1,700원 10개

구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])
[콜라-10]

현재 콜라 4개는 프로모션 할인이 적용되지 않습니다. 그래도 구매하시겠습니까? (Y/N)
Y

멤버십 할인을 받으시겠습니까? (Y/N)
N

==============W 편의점================
상품명		수량	금액
콜라		10 	10,000
=============증	정===============
콜라		2
====================================
총구매액		10	10,000
행사할인			-2,000
멤버십할인			-0
내실돈			 8,000

감사합니다. 구매하고 싶은 다른 상품이 있나요? (Y/N)
Y

안녕하세요. W편의점입니다.
현재 보유하고 있는 상품입니다.

- 콜라 1,000원 재고 없음 탄산2+1
- 콜라 1,000원 7개
- 사이다 1,000원 8개 탄산2+1
- 사이다 1,000원 7개
- 오렌지주스 1,800원 9개 MD추천상품
- 오렌지주스 1,800원 재고 없음
- 탄산수 1,200원 5개 탄산2+1
- 탄산수 1,200원 재고 없음
- 물 500원 10개
- 비타민워터 1,500원 6개
- 감자칩 1,500원 5개 반짝할인
- 감자칩 1,500원 5개
- 초코바 1,200원 5개 MD추천상품
- 초코바 1,200원 5개
- 에너지바 2,000원 재고 없음
- 정식도시락 6,400원 8개
- 컵라면 1,700원 1개 MD추천상품
- 컵라면 1,700원 10개

구매하실 상품명과 수량을 입력해 주세요. (예: [사이다-2],[감자칩-1])
[오렌지주스-1]

현재 오렌지주스은(는) 1개를 무료로 더 받을 수 있습니다. 추가하시겠습니까? (Y/N)
Y

멤버십 할인을 받으시겠습니까? (Y/N)
Y

==============W 편의점================
상품명		수량	금액
오렌지주스		2 	3,600
=============증	정===============
오렌지주스		1
====================================
총구매액		2	3,600
행사할인			-1,800
멤버십할인			-0
내실돈			 1,800

감사합니다. 구매하고 싶은 다른 상품이 있나요? (Y/N)
N
```

</div>
</details>